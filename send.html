<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Email with URL Parameters</title>
    <!-- Include EmailJS SDK -->
    <script src="https://cdn.emailjs.com/dist/email.min.js" type="text/javascript"></script>
    <script type="text/javascript">
        // Function to get URL parameters
        function getQueryParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                to: params.get('to'),
                subject: params.get('subject'),
                message: params.get('message')
            };
        }

        // Function to send email
        function sendEmail() {
            const params = getQueryParams();

            // Check if all required parameters are provided
            if (params.to && params.subject && params.message) {
                // Create the email template dynamically as HTML content
                const emailContent = `
                    <h1>${params.subject}</h1>
                    <p>${params.message}</p>
                `;

                // Prepare the parameters for EmailJS
                const templateParams = {
                    to_email: params.to,  // Recipient email address
                    subject: params.subject,
                    html_message: emailContent  // HTML content of the email
                };

                // Log the template parameters to check their values
                console.log('Template Params:', templateParams);

                // Send email using EmailJS without a predefined template ID
                emailjs.send("service_vwyinve", { // service ID
                    to_email: templateParams.to_email,
                    subject: templateParams.subject,
                    html_message: templateParams.html_message
                }, "46kPHVk2Hlf0ZuJ5s")  // User ID (public key)
                    .then(response => {
                        alert('Email sent successfully!');
                        console.log('SUCCESS!', response.status, response.text);
                    })
                    .catch(error => {
                        alert('Failed to send email. Please try again.');
                        console.error('FAILED...', error);
                    });
            } else {
                alert('Missing parameters. Please provide "to", "subject", and "message" in the URL.');
            }
        }

        // Send email when the page is loaded
        window.onload = sendEmail;
    </script>
</head>
<body>
    <h1>Send Email with URL Parameters</h1>
    <p>This page will automatically send an email using parameters from the URL.</p>
</body>
</html>
